---
title: epoll扼要总结
date: 2015-06-22 21:56:12
tags:
- epoll
categories:
- linux
---

1. [水平触发与边缘触发](#%E6%B0%B4%E5%B9%B3%E8%A7%A6%E5%8F%91%E4%B8%8E%E8%BE%B9%E7%BC%98%E8%A7%A6%E5%8F%91)
2. [epoll 编程接口](#epoll-%E7%BC%96%E7%A8%8B%E6%8E%A5%E5%8F%A3)
3. [epoll与select的区别 (口诀 : 校内树)](#epoll%E4%B8%8Eselect%E7%9A%84%E5%8C%BA%E5%88%AB-%E5%8F%A3%E8%AF%80-%E6%A0%A1%E5%86%85%E6%A0%91)

# 水平触发与边缘触发

在深入讨论多种可选的m机制之前，我们需要先区分两种文件描述符准备就绪的通知模式。

- **水平触发**通知：如果文件描述符上可以非阻塞地执行I/O系统调用，此时认为它已经
就绪。
- **边缘触发**通知：如果文件描述符自上次状态检查以来有了新的I/O活动（比如新的输
入），此时需要触发通知。

表63-1总结了I/O多路复用、信号驱动I/O以及epoll所采用的通知模型。epoll API同其
他两种I/O模型的区别在于它对水平触发（默认）和边缘触发都支持。

{% asset_img epoll1.png epoll %}

# epoll 编程接口

epoll API是Linux系统专有的，在2.6版中新增。

epoll API的核心数据结构称作epoll实例，它和一个打开的文件描述符相关联。这个文件
描述符不是用来做I/O操作的，相反，它是内核数据结构的句柄，这些内核数据结构实现了两
个目的。

- 记录了在进程中声明过的感兴趣的文件描述符列表-**interest list（兴趣列表）**。
- 维护了处于I/O就绪态的文件描述符列表-**ready list（就绪列表）**。

ready list中的成员是interest list的子集。

对于由epoll检查的每一个文件描述符，我们可以指定一个位掩码来表示我们感兴趣的事
件。这些位掩码同poll()所使用的位掩码有着紧密的关联。

epoll API由以下3个系统调用组成。

- 系统调用**epoll_create()**创建一个epoll实例，返回代表该实例的文件描述符。
- 系统调用**epoll_ctl()**操作同epoll实例相关联的兴趣列表。通过epoll_ctl()，我们可以增
加新的描述符到列表中，将已有的文件描述符从该列表中移除，以及修改代表文件描述
符七事件类型的位掩码。
- 系统调用**epoll_wait()**返回与epoll实例相关联的就绪列表申的成员。

# epoll与select的区别 (口诀 : 校内树)

- **效率: ** 每次调用select0和poll0时，内核必须检查所有在调用中指定的文件描述符。与之相
反，当通过epoll_ctl0指定了需要监视的文件描述符时，内核会在与打开的文件描述
上下文相关联的列表中记录该描述符。之后每当执行I／O操作使得文件描述符成为就
绪态时，内核就在epoll描述符的就绪列表中添加一个元素。（单个打开的文件描述上
下文中的一次I]O事件可能导致与之相关的多个文件描述符成为就绪态。）之后的
epoll_wait0调用从就绪列表中简单地取出这些元素。

- **内存: ** 每次调用select0或poll()时，我们传递一个标记了所有待监视的文件描述符的
数据结构给内核，调用返回时，内核将所有标记为就绪态的文件描述符的数据
结构再传回给我们。与之相反，在epoll中我们使用epoll_ctl()在内核空间中建
立一个数据结构，该数据结构会将待监视的文件描述符都记录下来。一旦这个
数据结构建立完成，稍后每次调用epoll_wait0时就不需要再传递任何与文件描
述符有关的信息给内核了，而调用返回的信息中只包含那些已经处于就绪态的
描述符。

- **数量: ** select默认只支持1024个；epoll并没有最大数目限制